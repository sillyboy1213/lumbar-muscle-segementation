
## 项目背景

本项目旨在训练一个深度学习模型，用于自动分割医学影像（如CT或MRI）中的椎旁肌区域。椎旁肌的精确分割对于多种临床应用具有重要意义，例如脊柱疾病的诊断、手术规划和治疗效果评估。

## 项目结构

以下是本项目主要文件夹和代码的说明：

*   **`Dataset/`**: 存放用于模型训练、验证和测试的数据集。
    *   `Images/`: 包含原始的医学影像切片（如 `.png` 格式）。
    *   `Labels/`: 包含对应的手动分割的椎旁肌掩码图像（Ground Truth）。这里由于标注数据的原因，我只设置了5类标注，正常应该是有7类标注。
    *   `train1.txt`, `val1.txt`, `test.txt` (以及其他 `trainX.txt`, `valX.txt`): 这些文本文件定义了不同交叉验证折数下的训练集、验证集和测试集所包含的文件名列表。

*   **`Dataset_gen.py`**:
    *   此脚本负责加载和预处理数据集。它包含一个自定义的 `Dataset` 类（继承自 `torch.utils.data.Dataset`），用于读取图像和掩码，进行数据增强（如旋转、翻转），并将它们转换为模型训练所需的格式（例如，将掩码转换为 one-hot 编码的张量）。

*   **`networks/`**: 包含核心的神经网络模型结构定义，主要用于TransUnet训练时的权重初始化。
    *   `u_net.py`: 实现了标准的 U-Net 架构，常用于医学图像分割。
    *   `vit_seg_modeling_resnet_skip.py`: 可能包含基于 Vision Transformer (ViT) 和 ResNet 的分割模型架构，例如 TransUNet 中的编码器部分。

*   **`TransUnetcopy/`**:
    *   此文件夹似乎包含一个特定版本的 TransUNet 模型（一种结合了 Transformer 和 U-Net 优点的模型）的完整代码和实验设置。它内部有自己的 `networks/`, `utils/`, `checkpoint/`, `log/` 等子文件夹，可能用于独立的模型调优或复现。

*   **`utils/`**: 包含项目中通用的辅助工具和函数。
    *   `helpers.py`: 提供一些帮助函数，例如掩码和图像格式转换。
    *   `loss.py`: 定义了多种损失函数，如 Dice Loss、BCE Loss 或它们的组合，用于优化分割模型。
    *   `metrics.py`: 实现评估模型性能的指标，如 Dice 系数 (diceCoeffv2)。
    *   `misc.py`: 包含一些杂项工具，例如日志记录函数。

*   **`train.py`**:
    *   主要的模型训练脚本，可能用于训练标准的 U-Net 或其他单任务分割模型。它负责加载数据、初始化模型、定义优化器和学习率策略，并执行训练循环。

*   **`validate.py`**:
    *   用于在验证集上评估已训练模型的性能的脚本。

*   **`test.py`**:
    *   用于测试一些需要验证的东西。

*   **`target.py`**:
    *   定义了多任务学习模型的目标检测模块， `MultiTaskUNetWithRegionDetection`，该模型可能同时执行分割和目标区域检测任务。

*   **`target_train.py`**:
    *   专门用于训练 `target.py` 中定义的多任务模型的脚本。

*   **`target_validate.py`**:
    *   用于验证 `target_train.py` 训练出的多任务模型的脚本。

*   **`分段train.py`** (Segmented_train.py):
    *   一个特殊的训练脚本，用于实现多任务模型的分阶段训练。例如，它可能先加载一个预训练好的目标检测模块，并冻结其权重，然后只训练分割模块。

*   **`checkpoint/`**:
    *   用于存储训练过程中保存的模型检查点（`.pth` 文件）。主要的训练好的模型的存放位置。

*   **`log/`**:
    *   存放训练和验证过程中的日志文件。通常使用 TensorBoard 进行可视化，记录损失、准确率等指标随训练的变化。
    *   `log/train/`: 训练日志。
    *   `log/val/`: 验证日志。

*   **`results/`**:
    *  用于存放模型在测试集上的预测结果。

*   **`model/`**:
    *   用于存放最终训练好的模型文件或一些预训练模型的权重，例如 `TU_Synapse224/` 可能表示在 Synapse 数据集上训练的 TransUNet 模型。还有ViT的预训练权重。

*   **`kfold.py`**:
    *   如果项目使用 k-折交叉验证，此脚本可能用于生成或处理 k-折划分的数据列表。



